<script>
  import { deleteUserInfo } from '../../store';
  import { fetchClient } from '../../utils/axios';

  const btnLogout = document.querySelector('#btn-logout');

  btnLogout.addEventListener('click', async () => {
    try {
      const response = await fetchClient().post('/api/user/logout');
      if (response.status === 200) {
        deleteUserInfo();

        window.location.href = '/';
      }
    } catch (error) {
      console.log(error);
      alert('Oops.. ada kesalahan sistem, silahkan coba secara berkala.');
    }
  });

  // Mengambil data dari localStorage dengan kunci 'user'
  const storedUserData = JSON.parse(localStorage.getItem('user'));

  // Mendapatkan elemen dengan id 'storedUserData-role'
  const nipElement = document.getElementById('storedUserData-role');
  const namaElement = document.getElementById('storedUserData-nama');
  const nip1Element = document.getElementById('storedUserData-nip1');
  const nama1Element = document.getElementById('storedUserData-nama1');

  // Memeriksa apakah ada data yang tersimpan
  if (storedUserData) {
    // Jika ada, dapatkan nilai yang ingin Anda masukkan ke dalam elemen HTML
    const userNip = storedUserData.role_name;
    const userNama = storedUserData.nama_lengkap;

    // Masukkan nilai ke dalam elemen HTML
    nipElement.textContent = userNip;
    namaElement.textContent = userNama;
    nip1Element.textContent = userNip;
    nama1Element.textContent = userNama;
  } else {
    // Jika tidak ada data tersimpan, Anda dapat menangani kasus ini sesuai kebutuhan aplikasi Anda.
    alert('Tidak ada data pengguna yang tersimpan.');
  }
</script>

<nav class="header-nav ms-auto">
  <ul class="d-flex align-items-center">
    <li class="nav-item dropdown pe-3">
      <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
        <img src="/assets/eddg/profile-picture.png" alt="Profile" class="rounded-circle" />
        <span class="d-none d-md-block dropdown-toggle ps-2 text-center">
          <span class="text-primary-emphasis" id="storedUserData-nama1"></span>
          <br />
          <span class="text-primary-emphasis" id="storedUserData-nip1"></span>
        </span>
      </a>

      <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
        <li class="dropdown-header">
          <h6><span id="storedUserData-nama"></span></h6>
          <span id="storedUserData-role"></span>
        </li>
        <li>
          <hr class="dropdown-divider" />
        </li>

        <li>
          <a class="dropdown-item d-flex align-items-center" href="/profile">
            <i class="bi bi-person"></i>
            <span>My Profile</span>
          </a>
        </li>

        <li>
          <a class="dropdown-item d-flex align-items-center" href="/change-password">
            <i class="bi bi-lock"></i>
            <span>Ubah Kata Sandi</span>
          </a>
        </li>
        <li>
          <hr class="dropdown-divider" />
        </li>

        <li>
          <a class="dropdown-item d-flex align-items-center" id="btn-logout">
            <i class="bi bi-box-arrow-right"></i>
            <span>Sign Out</span>
          </a>
        </li>
      </ul>
    </li>
  </ul>
</nav>
